<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Sửa Sân</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style> #map-picker { height: 400px; width: 100%; border: 2px solid #ffc107; cursor: crosshair; } </style>
</head>
<body class="bg-light container mt-5">
    <div class="card shadow">
        <div class="card-header bg-warning"><h4>✏️ Sửa Thông Tin Sân</h4></div>
        <div class="card-body">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-6 mb-3"><label>Tên Sân:</label>{{ form.ten_san }}</div>
                    <div class="col-md-6 mb-3"><label>Giá Tiền:</label>{{ form.gia_tien }}</div>
                </div>
                <div class="mb-3"><label>Địa Chỉ:</label>{{ form.dia_chi }}</div>
                
                <div class="mb-3">
                    <label>Hình ảnh hiện tại:</label>
                    {% if san.hinh_anh %}
                        <div class="mb-2"><img src="{{ san.hinh_anh.url }}" height="100"></div>
                    {% endif %}
                    <label>Chọn ảnh mới (nếu muốn thay):</label>
                    {{ form.hinh_anh }}
                </div>

                <div id="map-picker"></div>
                <div class="row mt-2">
                    <div class="col-6"><label>Vĩ độ:</label>{{ form.vi_do }}</div>
                    <div class="col-6"><label>Kinh độ:</label>{{ form.kinh_do }}</div>
                </div>

                <div class="mt-4 text-center">
                    <button type="submit" class="btn btn-warning">Cập nhật</button>
                    <a href="{% url 'home' %}" class="btn btn-secondary">Hủy</a>
                </div>
            </form>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var oldLat = {{ san.vi_do }}, oldLng = {{ san.kinh_do }};
        var map = L.map('map-picker').setView([oldLat, oldLng], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        var marker = L.marker([oldLat, oldLng]).addTo(map);
        map.on('click', function(e) {
            var lat = e.latlng.lat, lng = e.latlng.lng;
            if (marker) map.removeLayer(marker);
            marker = L.marker([lat, lng]).addTo(map);
            document.getElementById('txtLat').value = lat.toFixed(6);
            document.getElementById('txtLng').value = lng.toFixed(6);
        });
    </script>
</body>
</html>